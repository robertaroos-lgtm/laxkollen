<!doctype html>
<html lang="sv">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>Läxkollen</title>

  <!-- PWA setup -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#6366f1">
  <link rel="apple-touch-icon" href="icons/icon-192-LK.png">
  <link rel="icon" type="image/png" sizes="192x192" href="icons/icon-192-LK.png">
  <link rel="icon" type="image/png" sizes="512x512" href="icons/icon-512-LK.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">

  <link rel="stylesheet" href="./style.css?v=6">
</head>
<body>
<div class="app">
  <h1>Läxkollen</h1>

  <div class="topbar">
    <div><select id="child-select" aria-label="Välj barn"></select></div>
    <button id="manage-children" class="ghost">Hantera barn</button>
    <div class="spacer"></div>
  </div>

  <div class="actions-row">
    <button id="add-quick" class="primary" aria-expanded="false" aria-controls="input-row">Lägg till läxa/prov</button>
  </div>

  <div id="subject-summary" class="summary" aria-label="Översikt per ämne"></div>

  <div id="input-row" class="row compact-gap" hidden>
    <div class="field">
      <label for="subject">Ämne</label>
      <select id="subject"></select>
    </div>
    <div class="field">
      <label for="task">Läxa</label>
      <input id="task" type="text" placeholder="Beskriv läxan"/>
    </div>
    <div class="field prov">
      <label for="is-exam">Prov</label>
      <div class="checkline"><input id="is-exam" type="checkbox"/></div>
    </div>
    <div class="field">
      <label for="due">Datum</label>
      <input id="due" type="date"/>
    </div>
    <div class="field">
      <label for="times">Antal repitioner</label>
      <input id="times" type="number" min="1" value="1"/>
    </div>
    <div class="field" style="justify-content:flex-end;">
      <button id="add" class="primary" disabled aria-disabled="true">Lägg till</button>
    </div>
  </div>

  <div class="row">
    <span class="chip active" data-filter="active">Kvar att göra</span>
    <span class="chip" data-filter="exam">Prov</span>
    <span class="chip" data-filter="done">Historik</span>
  </div>

  <div id="history-note" class="notice" hidden>Historik visar bara uppgifter från de senaste 30 dagarna.</div>

  <ul id="list"></ul>
</div>

<!-- Hantera barn -->
<div id="modal-backdrop" class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="manage-title" hidden>
  <div class="modal">
    <h2 id="manage-title">Hantera barn</h2>
    <div class="note" id="onboarding-note" style="display:none;">Välkommen! Börja med att lägga till ett barn och välja ämnen. Du kan inte stänga förrän minst ett barn finns.</div>

    <div style="margin-top:10px;">
      <strong>Lägg till nytt barn</strong>
      <div class="child-row">
        <input id="new-child-name" type="text" placeholder="Barnets namn" style="min-width:200px;">
        <div class="subjects-collection" id="new-child-subjects"></div>
        <button id="save-new-child" class="primary">Lägg till barn</button>
      </div>

      <div class="modal-actions">
        <button id="cancel-modal" class="ghost">Avbryt</button>
        <button id="close-modal" class="primary">Spara och Stäng</button>
      </div>
    </div>

    <hr style="border:none;border-top:1px solid #eee;margin:12px 0;">

    <div>
      <strong>Aktuella barn</strong>
      <div id="children-list"></div>
    </div>
  </div>
</div>

<!-- Redigera -->
<div id="edit-backdrop" class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="edit-title" hidden>
  <div class="modal" style="max-width:640px">
    <h2 id="edit-title">Redigera</h2>
    <div class="row">
      <div class="field">
        <label for="edit-subject">Ämne</label>
        <select id="edit-subject"></select>
      </div>
      <div class="field">
        <label for="edit-task">Läxa</label>
        <input id="edit-task" type="text" />
      </div>
    </div>
    <div class="row compact-gap">
      <div class="field prov">
        <label for="edit-is-exam">Prov</label>
        <div class="checkline"><input id="edit-is-exam" type="checkbox"/></div>
      </div>
      <div class="field">
        <label for="edit-due">Datum</label>
        <input id="edit-due" type="date"/>
      </div>
      <div class="field">
        <label for="edit-times">Antal repitioner</label>
        <input id="edit-times" type="number" min="1" />
      </div>
    </div>
    <div class="modal-actions">
      <button id="edit-cancel" class="ghost">Avbryt</button>
      <button id="edit-save" class="primary">Spara</button>
    </div>
  </div>
</div>

<div id="toast" class="toast" role="status" aria-live="polite" aria-atomic="true"></div>

<script src="./app.js?v=6" defer></script>
<script>
// Register SW
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('./sw.js').catch(()=>{});
  });
}
</script>

<script>
document.addEventListener('touchmove', function (e) {
  let el = e.target;
  while (el) {
    if (el.classList && (el.classList.contains('app') || el.classList.contains('modal'))) return;
    el = el.parentElement;
  }
  e.preventDefault();
}, { passive: false });
</script>

</body>
</html>
