<!doctype html>
<html lang="sv">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover"/>
  <title>Läxkollen</title>
  <meta name="theme-color" content="#6366f1">
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icons/icon-192-LK.png">
  <link rel="icon" type="image/png" sizes="192x192" href="icons/icon-192-LK.png">
  <link rel="icon" type="image/png" sizes="512x512" href="icons/icon-512-LK.png">
  <link rel="stylesheet" href="style.css?v=13.7.0">
  <style>
    #lk-banner {
      position: fixed; top: 0; left: 0; right: 0;
      background: #22c55e; color: #fff; text-align: center;
      padding: 8px 12px; font-weight: 800; z-index: 9999; display: none;
    }
  </style>
  <script>
  ;(function(){
    function clearAll(){
      var tasks=[];
      if('serviceWorker' in navigator){
        tasks.push(navigator.serviceWorker.getRegistrations().then(function(regs){
          return Promise.all(regs.map(function(r){ return r.unregister(); }));
        }));
      }
      if('caches' in window){
        tasks.push(caches.keys().then(function(keys){
          return Promise.all(keys.map(function(k){ return caches.delete(k); }));
        }));
      }
      Promise.all(tasks).then(function(){
        alert('Cache & SW rensade – laddar om…');
        location.replace(location.origin + location.pathname);
      });
    }
    try {
      var p = new URLSearchParams(location.search||'');
      if(p.get('forceclear')==='1'){ clearAll(); }
    } catch(e){}
  })();

  window.addEventListener('error', function(e){
    var b=document.getElementById('lk-banner');
    if(b){ b.style.display='block'; b.textContent='Fel: '+(e.message||e); }
  });
  window.addEventListener('unhandledrejection', function(e){
    var b=document.getElementById('lk-banner');
    var msg=e&&e.reason?(e.reason.message||String(e.reason)):'Okänt fel';
    if(b){ b.style.display='block'; b.textContent='Fel (promise): '+msg; }
  });
  </script>
</head>
<body>
<div id="lk-banner">LK 13.7.0</div>
<div id="app-root"></div>
<script src="app.js?v=13.7.0" defer></script>
<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', function () {
    navigator.serviceWorker.register('./sw.js').then(function(reg){
      navigator.serviceWorker.addEventListener('controllerchange', function(){
        if (!window.__lk_reloaded_once) {
          window.__lk_reloaded_once = true;
          location.reload();
        }
      });
    }).catch(function(e){ console.log(e); });
  });
}
</script>
</body>
</html>
